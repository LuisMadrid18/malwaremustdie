#!/bin/sh
# on incidents this script is useful as one of step to -
# offline the box from establshed connection
# mod by @unixfreaxjp 2013

# The location of the 'iptables' binary
MODPROBE="/sbin/modprobe"
IPTABLES="/sbin/iptables"

# -----Loading Modules------
$MODPROBE iptable_nat
$MODPROBE ip_nat_ftp
$MODPROBE ip_conntrack_ftp

# IP Fowarding ready (Can't remove this)
echo 0 > /proc/sys/net/ipv4/ip_forward
echo 1 > /proc/sys/net/ipv4/ip_forward

# Remove any existing rules from the built-in chains
$IPTABLES --flush
$IPTABLES -t nat --flush
$IPTABLES -t mangle --flush

# Unlimited traffic on the loopback interface
$IPTABLES -A INPUT  -i lo -j ACCEPT
$IPTABLES -A OUTPUT -o lo -j ACCEPT

# Set the default policies to drop.
$IPTABLES --policy INPUT   DROP
$IPTABLES --policy OUTPUT  DROP
$IPTABLES --policy FORWARD DROP

$IPTABLES -t nat --policy PREROUTING  DROP
$IPTABLES -t nat --policy OUTPUT      DROP
$IPTABLES -t nat --policy POSTROUTING DROP

$IPTABLES -t mangle --policy PREROUTING  DROP
$IPTABLES -t mangle --policy OUTPUT      DROP

# Remove and pre-existing user-defined chains
$IPTABLES --delete-chain
$IPTABLES -t nat --delete-chain
$IPTABLES -t mangle --delete-chain
